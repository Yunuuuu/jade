{
    "version": "mame0259",
    "description": "Arcade machine emulator",
    "homepage": "http://mamedev.org",
    "license": {
        "identifier": "GPL-2.0",
        "url": "https://github.com/mamedev/mame/blob/master/COPYING"
    },
    "architecture": {
        "64bit": {
            "url": "https://github.com/mamedev/mame/releases/download/mame0259/mame0259b_64bit.exe#/dl.7z",
            "hash": "b426f8dfe80e7eab797006b10b7e9d6fed2de4bb7d33a8ad05cb9f28c4101d5a"
        }
    },
    "pre_install": [
        "if (!(test-path $persist_dir)) { New-Item -type directory $persist_dir > $null }",
        "if ($global) {",
        "    $app_dir = \"$globaldir\\apps\\$app\\current\"",
        "} else {",
        "    $app_dir = \"$scoopdir\\apps\\$app\\current\"",
        "}",
        "$home_dir_path = '%USERPROFILE%/mame'",
        "$install_dir_path = \"$app_dir\".Replace('\\', '/')",
        "if (!(Test-Path \"$persist_dir\\mame.ini\")) {",
        "    $main_content = Get-Content \"$bucketsdir\\jade\\config\\mame\\mame.ini\"",
        "    $main_content = $main_content.Replace('$home_dir', $home_dir_path)",
        "    $main_content = $main_content.Replace('$install_dir', $install_dir_path)",
        "    Set-Content -Path \"$persist_dir\\mame.ini\" -value $main_content",
        "}",
        "if (!(Test-Path \"~\\mame.ini\")) {",
        "    New-Item -Path \"~\\mame.ini\" -ItemType HardLink -Target \"$persist_dir\\mame.ini\" | Out-Null",
        "}",
        "if (!(test-path \"$persist_dir\\ini\")) { ",
        "    if (test-path \"$dir\\ini\") {",
        "        Move-Item -Path \"$dir\\ini\" -Destination $persist_dir",
        "    } else {",
        "        New-Item -type directory \"$persist_dir\\ini\" > $null",
        "    }",
        "}",
        "if (!(test-path \"$persist_dir\\ini\\ui.ini\")) { ",
        "    $ui_content = Get-Content \"$bucketsdir\\jade\\config\\mame\\ui.ini\"",
        "    $ui_content = $ui_content.Replace('$home_dir', $home_dir_path)",
        "    $ui_content = $ui_content.Replace('$install_dir', $install_dir_path)",
        "    Set-Content -Path \"$persist_dir\\ini\\ui.ini\" -value $ui_content",
        "}"
    ],
    "bin": [
        [
            "mame.exe",
            "mame"
        ],
        [
            "chdman.exe",
            "chdman"
        ]
    ],
    "shortcuts": [
        [
            "mame.exe",
            "MAME"
        ]
    ],
    "persist": [
        "mame.ini",
        "ini"
    ],
    "uninstaller": {
        "script": [
            "function remove_link($dir) {",
            "    write-host \"Unlinking $dir\"",
            "    $source = (Get-Item -Path $dir -Force)",
            "    if ($source.LinkType) {",
            "        $source_path = $source.FullName",
            "        # directory (junction)",
            "        if ($source -is [System.IO.DirectoryInfo]) {",
            "            # remove read-only attribute on the link",
            "            attrib -R /L $source_path",
            "            # remove the junction",
            "            Remove-Item -Path $source_path -Recurse -Force -ErrorAction SilentlyContinue",
            "        } else {",
            "            # remove the hard link",
            "            Remove-Item -Path $source_path -Force -ErrorAction SilentlyContinue",
            "        }",
            "    }",
            "}",
            "remove_link \"~\\mame.ini\""
        ]
    },
    "checkver": {
        "github": "https://github.com/mamedev/mame",
        "regex": "\\/releases\\/tag\\/([\\d.a-zA-Z]+)"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://github.com/mamedev/mame/releases/download/$version/$versionb_64bit.exe#/dl.7z",
                "hash": {
                    "url": "https://github.com/mamedev/mame/releases/download/$version/SHA256SUMS"
                }
            }
        }
    }
}
